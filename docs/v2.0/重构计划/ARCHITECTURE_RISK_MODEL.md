# SQLRustGo 架构风险评分模型

> 版本：v1.0
> 日期：2026-02-18
> 目标：把"感觉有问题"变成"可量化风险"

---

## 一、评分维度（7 大核心指标）

每项 0-5 分：

| 分值 | 含义 |
|:-----|:-----|
| 0 | 极好 |
| 1 | 很低风险 |
| 2 | 可接受 |
| 3 | 有风险 |
| 4 | 高风险 |
| 5 | 严重风险 |

---

## 二、各维度详细定义

### 2.1 模块耦合度（权重 20%）

**问题**：
- 是否存在循环依赖？
- 是否存在跨层直接访问？
- executor 是否直接访问 parser 结构？

**评分标准**：

| 分值 | 标准 |
|:-----|:-----|
| 0 | 完全单向依赖 |
| 1 | 单向依赖，少量跨层访问 |
| 2 | 单向依赖，有跨层访问 |
| 3 | 存在少量反向依赖 |
| 4 | 多层交叉耦合 |
| 5 | 严重循环依赖 |

### 2.2 抽象层清晰度（权重 15%）

**问题**：
- 是否大量使用 concrete type？
- 是否缺少 trait 抽象？

**评分标准**：

| 分值 | 标准 |
|:-----|:-----|
| 0 | 完全基于 trait 抽象 |
| 1 | 核心模块有 trait 抽象 |
| 2 | 部分模块有 trait 抽象 |
| 3 | 少量 trait 抽象 |
| 4 | 几乎无 trait 抽象 |
| 5 | 完全无抽象 |

### 2.3 全局状态风险（权重 10%）

**问题**：
- 是否存在 `static mut`？
- 是否共享可变状态？

**评分标准**：

| 分值 | 标准 |
|:-----|:-----|
| 0 | 无全局状态 |
| 1 | 有全局只读状态 |
| 2 | 有少量可变全局状态 |
| 3 | 有多处可变全局状态 |
| 4 | 大量全局可变状态 |
| 5 | 全局状态混乱 |

### 2.4 API 稳定性风险（权重 15%）

**问题**：
- 是否随意修改 pub 接口？
- 是否无版本兼容策略？

**评分标准**：

| 分值 | 标准 |
|:-----|:-----|
| 0 | API 已冻结，有兼容策略 |
| 1 | API 基本稳定 |
| 2 | API 有变化但有文档 |
| 3 | API 偶尔变化 |
| 4 | API 频繁变化 |
| 5 | API 完全不稳定 |

### 2.5 测试覆盖率风险（权重 15%）

**评分标准**：

| 分值 | 覆盖率 |
|:-----|:-------|
| 0 | ≥ 90% |
| 1 | 80-90% |
| 2 | 70-80% |
| 3 | 50-70% |
| 4 | 30-50% |
| 5 | < 30% |

### 2.6 性能可观测性（权重 15%）

**问题**：
- 是否有 benchmark？
- 是否有性能回归检测？

**评分标准**：

| 分值 | 标准 |
|:-----|:-----|
| 0 | 完整 benchmark + CI 检测 |
| 1 | 有 benchmark |
| 2 | 有部分 benchmark |
| 3 | 有手动性能测试 |
| 4 | 无性能测试 |
| 5 | 完全无性能观测 |

### 2.7 可扩展性（权重 10%）

**问题**：
- 是否可插拔？
- 是否硬编码执行策略？

**评分标准**：

| 分值 | 标准 |
|:-----|:-----|
| 0 | 完全插件化 |
| 1 | 核心可插拔 |
| 2 | 部分可插拔 |
| 3 | 有扩展点但未抽象 |
| 4 | 几乎不可扩展 |
| 5 | 完全硬编码 |

---

## 三、总分计算

```
总风险 = Σ(分数 × 权重)
```

**区间**：

| 分数 | 级别 |
|:-----|:-----|
| 0-1.5 | 🟢 健康 |
| 1.5-2.5 | 🟡 轻度风险 |
| 2.5-3.5 | 🟠 中度风险 |
| 3.5-4.5 | 🔴 高风险 |
| > 4.5 | 💀 架构危机 |

---

## 四、当前评估

### 4.1 预估评分

| 维度 | 权重 | 预估分数 | 加权分数 |
|:-----|:-----|:---------|:---------|
| 模块耦合度 | 20% | 3 | 0.60 |
| 抽象层清晰度 | 15% | 3 | 0.45 |
| 全局状态风险 | 10% | 2 | 0.20 |
| API 稳定性风险 | 15% | 4 | 0.60 |
| 测试覆盖率风险 | 15% | 2 | 0.30 |
| 性能可观测性 | 15% | 4 | 0.60 |
| 可扩展性 | 10% | 4 | 0.40 |
| **总计** | 100% | - | **3.15** |

### 4.2 当前状态

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          架构风险评估                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   总分：3.15                                                                │
│   级别：🟠 中度风险                                                         │
│                                                                              │
│   主要风险：                                                                │
│   ├── API 稳定性风险（0.60）                                                │
│   ├── 性能可观测性（0.60）                                                  │
│   ├── 模块耦合度（0.60）                                                    │
│   └── 可扩展性（0.40）                                                      │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 五、改进目标

### 5.1 目标评分（L3 产品级）

| 维度 | 当前 | 目标 | 改进措施 |
|:-----|:-----|:-----|:---------|
| 模块耦合度 | 3 | 1 | 切断循环依赖 |
| 抽象层清晰度 | 3 | 1 | 引入 trait 抽象 |
| 全局状态风险 | 2 | 1 | 消除全局状态 |
| API 稳定性风险 | 4 | 1 | 冻结 API |
| 测试覆盖率风险 | 2 | 1 | 提升到 85% |
| 性能可观测性 | 4 | 1 | 建立 benchmark |
| 可扩展性 | 4 | 1 | 插件化架构 |

### 5.2 目标总分

```
目标总分 = 1.35（轻度风险 → 健康）
```

---

*本文档由 TRAE (GLM-5.0) 创建*
