# SQLRustGo 长期架构治理蓝图

> 版本：v1.0
> 日期：2026-02-18
> 规划周期：3-5 年

---

## 一、分支保护规则配置

### 1.1 baseline（最高级保护）

进入：`GitHub → Settings → Branches → Add Rule`

**必须开启**：

| 规则 | 说明 |
|:-----|:-----|
| ✅ Require pull request before merging | 必须通过 PR 合并 |
| ✅ Require approvals (1-2 人) | 需要审核批准 |
| ✅ Require status checks to pass | CI 必须通过 |
| ✅ Require conversation resolution | 所有讨论必须解决 |
| ✅ Require linear history | 保持线性历史 |
| ✅ Include administrators | 管理员也需遵守 |
| ❌ 禁止 force push | 禁止强制推送 |
| ❌ 禁止删除分支 | 禁止删除 |

**意义**：baseline 永远保持"可发布状态"

### 1.2 release

| 规则 | 说明 |
|:-----|:-----|
| ✅ Require pull request | 必须通过 PR |
| ✅ Require status checks | CI 必须通过 |
| ✅ 至少 1 审核 | 需要审核 |
| ❌ 禁止 force push | 禁止强制推送 |

**允许**：修阻断 bug

### 1.3 beta

| 规则 | 说明 |
|:-----|:-----|
| ✅ Require pull request | 必须通过 PR |
| ✅ Require CI pass | CI 必须通过 |
| ⚠️ 不强制多人审批 | 可 1 人审核 |

**允许**：修 bug、小幅优化

### 1.4 alpha

| 规则 | 说明 |
|:-----|:-----|
| ✅ Require PR | 必须通过 PR |
| ✅ Require CI pass | CI 必须通过 |
| ✅ 可允许 squash merge | 允许压缩合并 |

**允许**：新功能、重构

---

## 二、GitHub 权限控制模型

### 2.1 角色定义

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          权限控制模型                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   👑 Core Maintainer（核心维护者）                                           │
│   ├── 推 baseline                                                           │
│   ├── 推 release                                                            │
│   ├── 管理 tag                                                              │
│   ├── 管理分支保护                                                          │
│   └── 人数建议：1-2 人                                                      │
│                                                                              │
│   🛠 Developer（开发者）                                                     │
│   ├── 推 alpha                                                              │
│   ├── 提 PR 到 beta                                                         │
│   ├── 创建 feature 分支                                                     │
│   ├── ❌ 不能直接 push baseline                                             │
│   └── ❌ 不能修改 tag                                                       │
│                                                                              │
│   🤖 AI Agent（自动协作者）                                                  │
│   ├── 只能 push 到 feature/*                                                │
│   ├── 只能提 PR                                                             │
│   ├── ❌ 禁止直接 push alpha 以上分支                                        │
│   └── 建议用专门 GitHub Bot 账户                                            │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 AI Agent 账户建议

| Agent | GitHub 账户 | 权限级别 |
|:------|:------------|:---------|
| Codex | yinglichina8848 | Developer |
| Claude Code | sonaheartopen | Developer |
| OpenCode | sonaopenheart | Developer |
| TRAE | yinglichina | Developer |

---

## 三、演进阶段规划

### 3.1 第一阶段（0-6个月）

**目标**：
- 功能稳定
- API 基本确定
- 引入 CI/CD
- 架构模块化

**结构建议**：

```
src/
├── core/           # 核心类型和 trait
├── parser/         # SQL 解析器
├── executor/       # 执行引擎
├── storage/        # 存储引擎
├── planner/        # 查询规划器
├── network/        # 网络层
└── tests/          # 集成测试
```

### 3.2 第二阶段（6-18个月）

**目标**：
- 性能优化
- 插件化设计
- 可扩展接口

**建议**：
- 引入 trait 抽象
- 插件式 optimizer
- 模块隔离边界清晰

**架构演进**：

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        第二阶段架构                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                  │
│   │   Parser    │ ──► │  Planner    │ ──► │  Executor   │                  │
│   │   (trait)   │     │  (plugin)   │     │  (trait)    │                  │
│   └─────────────┘     └─────────────┘     └─────────────┘                  │
│                              │                                               │
│                              ▼                                               │
│                       ┌─────────────┐                                       │
│                       │  Optimizer  │                                       │
│                       │  (plugin)   │                                       │
│                       └─────────────┘                                       │
│                              │                                               │
│                              ▼                                               │
│   ┌─────────────┐     ┌─────────────┐                                       │
│   │   Storage   │ ◄── │  Index      │                                       │
│   │   (trait)   │     │  (plugin)   │                                       │
│   └─────────────┘     └─────────────┘                                       │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 第三阶段（长期）

**目标**：
- 多后端支持
- 分布式支持
- 云原生部署
- SDK

**建议**：
- gRPC API 层
- CLI 工具
- Web 控制台
- Docker 部署

**架构演进**：

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        第三阶段架构                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                        Client Layer                                  │   │
│   │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐            │   │
│   │  │   CLI    │  │  SDK     │  │  Web UI  │  │  gRPC    │            │   │
│   │  └──────────┘  └──────────┘  └──────────┘  └──────────┘            │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                          │
│                                   ▼                                          │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                        API Gateway                                   │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                          │
│                                   ▼                                          │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                        Core Engine                                   │   │
│   │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐            │   │
│   │  │  Parser  │  │  Planner │  │ Executor │  │ Storage  │            │   │
│   │  └──────────┘  └──────────┘  └──────────┘  └──────────┘            │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                          │
│                                   ▼                                          │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                        Storage Backends                              │   │
│   │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐            │   │
│   │  │  Memory  │  │   File   │  │   S3     │  │ Distributed│           │   │
│   │  └──────────┘  └──────────┘  └──────────┘  └──────────┘            │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 四、架构演进原则

### 4.1 核心原则

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          架构演进原则                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   1️⃣ 模块独立                                                              │
│      每个模块可独立开发、测试、部署                                          │
│                                                                              │
│   2️⃣ 接口优先                                                              │
│      先定义接口，再实现                                                      │
│                                                                              │
│   3️⃣ 依赖反转                                                              │
│      高层模块不依赖低层模块，都依赖抽象                                       │
│                                                                              │
│   4️⃣ 避免循环依赖                                                          │
│      使用依赖注入解耦                                                        │
│                                                                              │
│   5️⃣ 每个模块可单测                                                        │
│      模块边界清晰，可独立测试                                                │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 技术债控制策略

每个版本：

| 规则 | 说明 |
|:-----|:-----|
| 不超过 5 个 TODO | 控制技术债数量 |
| 每次重构必须有测试 | 保证质量 |
| 禁止无测试重构 | 防止回归 |

---

## 五、版本里程碑

### 5.1 v1.0.0 (当前)

- [x] 基础 SQL 解析
- [x] B+ Tree 索引
- [x] Volcano 执行引擎
- [x] 事务管理
- [x] WAL 日志
- [x] MySQL 协议基础

### 5.2 v1.1.0 (Beta 阶段)

- [ ] 聚合函数
- [ ] 错误处理改进
- [ ] 测试覆盖率 85%
- [ ] 客户端/服务器分离

### 5.3 v1.2.0 (规划中)

- [ ] JOIN 支持
- [ ] 子查询支持
- [ ] 索引优化
- [ ] 查询缓存

### 5.4 v2.0.0 (长期)

- [ ] 插件化架构
- [ ] 多存储后端
- [ ] 分布式支持
- [ ] 云原生部署

---

## 六、最终治理体系

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        工程治理体系总览                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   ✅ 版本推进体系 (VERSION_PROMOTION_SOP.md)                                 │
│   ✅ CI/CD (.github/workflows/)                                             │
│   ✅ 权限控制 (本文档)                                                       │
│   ✅ Commit 规范 (COMMIT_CONVENTION.md)                                      │
│   ✅ 自动版本 (scripts/bump_version.sh)                                      │
│   ✅ 长期架构蓝图 (本文档)                                                   │
│   ✅ AI 协作安全模型 (AI增强软件工程/AI_AGENT_COLLAB_GOVERNANCE.md)                         │
│                                                                              │
│   这已经是一个：                                                             │
│   🏆 可支撑 5 年演进的工程治理体系                                            │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

*本文档由 TRAE (GLM-5.0) 创建*
