---
marp: true
theme: gaia
paginate: true
backgroundColor: #fff
color: #333
---

<!-- _class: lead -->

# 第十四讲：发布门禁与检查清单

## AI增强的软件工程

---

# 课程大纲

1. **发布门禁概述**（25分钟）
2. **门禁类型与配置**（25分钟）
3. **RC版本验收**（25分钟）
4. **实践练习**（15分钟）

---

# Part 1: 发布门禁概述

---

## 1.1 What：什么是发布门禁

### 定义

发布前必须通过的检查点，确保发布质量

### 门禁的作用

- **质量保证**：确保代码质量达标
- **风险控制**：防止有问题的版本发布
- **流程规范**：标准化发布流程

---

## 1.2 Why：为什么需要发布门禁

### 质量保证

- 防止低质量代码发布
- 确保功能正确性
- 保证性能达标

### 风险控制

- 防止安全漏洞发布
- 防止严重Bug发布
- 降低发布风险

### 团队协作

- 明确发布标准
- 减少争议
- 提高协作效率

---

## 1.3 How：门禁配置

### 门禁类型

- 代码门禁：编译、测试、格式化
- 质量门禁：代码覆盖率、代码质量
- 安全门禁：安全扫描、依赖检查
- 功能门禁：功能测试、回归测试
- 性能门禁：性能测试、压力测试
- 文档门禁：文档完整性、API文档

---

# Part 2: 门禁类型与配置

---

## 2.1 代码门禁

### 编译检查

```yaml
- name: Build
  run: cargo build --release
```

### 测试检查

```yaml
- name: Test
  run: cargo test --all-features
```

### 格式化检查

```yaml
- name: Format check
  run: cargo fmt -- --check
```

### Clippy检查

```yaml
- name: Clippy
  run: cargo clippy -- -D warnings
```

---

## 2.2 质量门禁

### 测试覆盖率

```yaml
- name: Coverage
  run: |
    cargo tarpaulin --out Xml --output-dir coverage
  continue-on-error: false
  
- name: Upload coverage
  uses: codecov/codecov-action@v3
  with:
    files: coverage/cobertura.xml
    fail_ci_if_error: true
```

### 代码质量

```yaml
- name: SonarQube Scan
  uses: sonarsource/sonarqube-scan-action@master
  env:
    SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
```

---

## 2.3 安全门禁

### 依赖扫描

```yaml
- name: Dependency scan
  run: cargo audit
```

### 代码扫描

```yaml
- name: CodeQL Analysis
  uses: github/codeql-action/analyze@v2
```

---

## 2.4 功能门禁

### 集成测试

```yaml
- name: Integration tests
  run: cargo test --test integration
```

### 回归测试

```yaml
- name: Regression tests
  run: |
    ./scripts/run_regression_tests.sh
```

---

## 2.5 性能门禁

### 性能测试

```yaml
- name: Performance tests
  run: cargo bench
```

### 压力测试

```yaml
- name: Stress tests
  run: |
    ./scripts/run_stress_tests.sh
```

---

## 2.6 文档门禁

### 文档生成

```yaml
- name: Generate docs
  run: cargo doc --no-deps
```

### 文档检查

```yaml
- name: Check docs
  run: |
    ./scripts/check_docs.sh
```

---

# Part 3: RC版本验收

---

## 3.1 RC版本定义

### Release Candidate

- 发布候选版本
- 通过所有门禁
- 准备正式发布

### RC版本特征

- 功能完整
- 质量达标
- 文档完善
- 测试充分

---

## 3.2 RC门禁验收清单

### 代码门禁

| 检查项 | 命令 | 状态 |
|--------|------|------|
| 编译 | `cargo build --release` | ✅ 通过 |
| 测试 | `cargo test` | ✅ 通过 |
| Clippy | `cargo clippy` | ✅ 无警告 |
| 格式化 | `cargo fmt --check` | ✅ 通过 |

### 质量门禁

| 检查项 | 目标 | 实际 | 状态 |
|--------|------|------|------|
| 测试覆盖率 | ≥80% | 85% | ✅ 达标 |
| 代码质量 | A级 | A级 | ✅ 达标 |

---

## 3.2 RC门禁验收清单（续）

### 安全门禁

| 检查项 | 结果 | 状态 |
|--------|------|------|
| 依赖扫描 | 无漏洞 | ✅ 通过 |
| 代码扫描 | 无高危 | ✅ 通过 |

### 功能门禁

| 检查项 | 结果 | 状态 |
|--------|------|------|
| 集成测试 | 全部通过 | ✅ 通过 |
| 回归测试 | 全部通过 | ✅ 通过 |

### 性能门禁

| 检查项 | 目标 | 实际 | 状态 |
|--------|------|------|------|
| 查询响应时间 | <100ms | 85ms | ✅ 达标 |
| 并发能力 | >1000 QPS | 1200 QPS | ✅ 达标 |

---

## 3.2 RC门禁验收清单（续）

### 文档门禁

| 检查项 | 结果 | 状态 |
|--------|------|------|
| README | 完善 | ✅ 通过 |
| API文档 | 100% | ✅ 通过 |
| 用户手册 | 完善 | ✅ 通过 |
| 安装指南 | 完善 | ✅ 通过 |

---

## 3.3 RC版本发布

### 创建RC标签

```bash
git tag -a v1.0.0-rc1 -m "RC1版本"
git push origin v1.0.0-rc1
```

### 发布RC版本

```markdown
# SQLRustGo v1.0.0-rc1

## 新功能
- 支持JOIN查询
- 支持子查询
- 支持视图

## 已知问题
- 性能待优化

## 测试结果
- 测试覆盖率：85%
- 所有门禁通过
```

---

# Part 4: 实践练习

---

## 4.1 配置门禁

### 任务

1. 配置GitHub Actions门禁
2. 添加所有门禁检查
3. 触发CI验证

### 配置文件

```yaml
name: Release Gates

on:
  push:
    tags:
      - 'v*-rc*'

jobs:
  gates:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Run all gates
      run: ./scripts/run_gates.sh
```

---

## 4.2 执行验收

### 任务

1. 运行所有门禁检查
2. 填写验收清单
3. 创建RC版本

### 验收清单

- [ ] 代码门禁通过
- [ ] 质量门禁通过
- [ ] 安全门禁通过
- [ ] 功能门禁通过
- [ ] 性能门禁通过
- [ ] 文档门禁通过

---

# 核心知识点总结

---

## 1. 发布门禁

- **What**：发布前必须通过的检查点
- **Why**：质量保证、风险控制、团队协作
- **How**：配置门禁检查、自动化执行

## 2. 门禁类型

- **代码门禁**：编译、测试、格式化、Clippy
- **质量门禁**：测试覆盖率、代码质量
- **安全门禁**：依赖扫描、代码扫描
- **功能门禁**：集成测试、回归测试
- **性能门禁**：性能测试、压力测试
- **文档门禁**：文档完整性、API文档

## 3. RC版本验收

- **RC版本定义**：发布候选版本
- **验收清单**：所有门禁检查
- **发布流程**：创建标签、发布公告

---

# 课后作业

---

## 任务

1. 配置完整的门禁检查
2. 执行RC版本验收
3. 创建RC版本标签

## 预习

- 版本发布与长期规划
- v3.0-5.0功能演进

---

<!-- _class: lead -->

# 谢谢！

## 下节课：版本发布与长期规划
