---
marp: true
theme: gaia
paginate: true
backgroundColor: #fff
color: #333
---

<!-- _class: lead -->

# 第九讲：软件治理与分支策略

## AI增强的软件工程

---

# 课程大纲

1. **软件治理概述**（25分钟）
2. **Git分支策略**（20分钟）
3. **分支保护与代码审核**（20分钟）
4. **实践练习**（15分钟）

---

# Part 1: 软件治理概述

---

## 1.1 What：什么是软件治理

### 定义

用规则和流程约束软件开发过程

### 治理层次

- **代码治理**：代码规范、代码审核
- **流程治理**：分支策略、发布流程
- **质量治理**：质量门禁、测试覆盖率
- **安全治理**：安全扫描、漏洞管理

---

## 1.1 What：什么是软件治理（续）

### 治理范围

- **开发阶段**：编码规范、代码审核
- **测试阶段**：测试策略、质量门禁
- **发布阶段**：发布流程、版本管理
- **运维阶段**：监控告警、问题处理

---

## 1.2 Why：为什么需要软件治理

### 规模化挑战

- 代码规模增长：1K → 100K → 1M+ lines
- 团队规模增长：1人 → 10人 → 100人
- 复杂度指数级增长

### 质量保证

- 防止代码腐烂
- 保证代码一致性
- 降低维护成本

---

## 1.2 Why：为什么需要软件治理（续）

### 风险控制

- 防止破坏性变更
- 保证发布质量
- 快速回滚能力

### 效率提升

- 减少重复工作
- 提高协作效率
- 加速开发迭代

### 业界案例

- **Google**：代码审查制度
- **Microsoft**：分支保护策略
- **Amazon**：质量门禁体系

---

## 1.3 How：如何实施软件治理

### 治理框架

1. **制定规则**：编码规范、流程规范
2. **建立流程**：开发流程、审核流程、发布流程
3. **配置工具**：Git保护、CI/CD、自动化检查
4. **持续改进**：定期评估、优化流程

### 治理工具链

- **代码规范**：ESLint、Prettier、Rustfmt
- **代码审核**：GitHub PR、Gerrit
- **质量门禁**：CI/CD、SonarQube
- **安全扫描**：Dependabot、Snyk

---

## 1.3 How：如何实施软件治理（续）

### 治理实践

- **从小到大**：先小团队试点，再全面推广
- **从松到严**：先宽松规则，逐步收紧
- **持续优化**：根据实际情况调整规则

### SQLRustGo治理实践

- **代码规范**：Rust官方规范 + 项目自定义规范
- **流程规范**：分支策略 + PR流程 + 发布流程
- **质量门禁**：CI检查 + 测试覆盖率 + 代码审查
- **安全治理**：依赖扫描 + 代码扫描 + 定期审计

---

# Part 2: Git分支策略

---

## 2.1 What：什么是分支策略

### 定义

管理代码分支创建、合并、删除的规则和流程

### 分支策略的作用

- **并行开发**：多人同时开发不同功能
- **隔离风险**：功能开发不影响主分支
- **版本管理**：清晰追踪每个版本的变更
- **发布控制**：控制发布节奏和质量

---

## 2.2 Why：为什么需要分支策略

### 协作需求

- 多人同时开发需要隔离
- 避免代码冲突
- 提高开发效率

### 质量控制

- 主分支保持稳定
- 功能开发不影响主分支
- 发布版本可追溯

### 风险管理

- 功能失败不影响其他功能
- 快速回滚到稳定版本
- A/B测试、灰度发布

---

## 2.3 How：常见分支策略

### Git Flow

```
master ────●────●────●────●────>
           │         │
release ───●─────────●
           │         │
develop ───●────●────●────●────>
           │    │    │
feature ───●────●    │
                │    │
hotfix ─────────●────●
```

**适用场景**：有明确发布周期的项目
**优点**：结构清晰，职责分明
**缺点**：流程复杂，分支管理成本高

---

## 2.3 How：常见分支策略（续）

### GitHub Flow

```
main ──────●────●────●────●────>
           │    │
feature ───●────●
```

**适用场景**：持续部署的项目
**优点**：简单易用，适合快速迭代
**缺点**：不适合多版本并行维护

### Trunk Based Development

```
main ──────●────●────●────●────>
           │    │    │
feature ───●────●────●
```

**适用场景**：高度自动化的团队
**优点**：减少合并冲突，加快开发速度
**缺点**：需要强大的自动化测试

---

## 2.4 SQLRustGo分支策略

### 分支类型

- **main**：主分支，保持稳定
- **develop**：开发分支，集成新功能
- **feature/\***：功能分支，开发新功能
- **release/\***：发布分支，准备发布
- **hotfix/\***：修复分支，紧急修复

### 分支命名规范

```
feature/add-join-support
feature/improve-query-optimizer
release/v1.0.0
hotfix/fix-buffer-pool-leak
```

---

# Part 3: 分支保护与代码审核

---

## 3.1 分支保护规则

### 主分支保护

- ✅ 禁止直接推送
- ✅ 必须通过PR合并
- ✅ 需要代码审查批准
- ✅ 需要通过CI检查

### GitHub分支保护配置

```
Settings → Branches → Add rule
- Branch name pattern: main
- Require pull request reviews before merging
- Require status checks to pass before merging
- Require branches to be up to date before merging
```

---

## 3.2 代码审核流程

### Pull Request流程

```
1. 创建功能分支
2. 编写代码和测试
3. 提交Pull Request
4. 代码审核
5. 修改代码（如需要）
6. 审核通过
7. 合并到主分支
```

### 代码审核要点

- **功能正确性**：代码是否实现了预期功能
- **代码质量**：代码是否清晰、规范
- **测试覆盖**：是否有足够的测试
- **文档完整**：是否更新了文档

---

## 3.3 代码审核实践

### 审核者职责

- 检查代码质量
- 提出改进建议
- 确保符合规范
- 批准或拒绝PR

### 提交者职责

- 编写清晰的PR描述
- 提供必要的上下文
- 及时响应审核意见
- 修改代码直到审核通过

### 审核工具

- **GitHub PR Review**
- **Gerrit**
- **Phabricator**

---

# Part 4: 实践练习

---

## 4.1 创建功能分支

```bash
# 创建并切换到功能分支
git checkout -b feature/add-join-support

# 编写代码
# ...

# 提交代码
git add .
git commit -m "feat: add JOIN support"

# 推送到远程
git push origin feature/add-join-support
```

---

## 4.2 创建Pull Request

### PR标题规范

```
feat: add JOIN support
fix: fix buffer pool memory leak
docs: update README
refactor: improve query optimizer
test: add unit tests for lexer
```

### PR描述模板

```markdown
## 变更类型
- [ ] 新功能
- [ ] Bug修复
- [ ] 重构
- [ ] 文档更新

## 变更说明
简要描述本次变更的内容

## 测试说明
描述如何测试本次变更

## 相关Issue
Closes #123
```

---

## 4.3 代码审核实践

### 审核检查清单

- [ ] 代码是否实现了预期功能
- [ ] 代码是否清晰易读
- [ ] 是否有足够的测试
- [ ] 是否更新了文档
- [ ] 是否符合编码规范
- [ ] 是否有安全风险

---

# 核心知识点总结

---

## 1. 软件治理

- **What**：用规则和流程约束软件开发过程
- **Why**：规模化挑战、质量保证、风险控制、效率提升
- **How**：治理框架、治理工具链、治理实践

## 2. Git分支策略

- **Git Flow**：适合有明确发布周期的项目
- **GitHub Flow**：适合持续部署的项目
- **SQLRustGo分支策略**：main/develop/feature/release/hotfix

## 3. 分支保护与代码审核

- **分支保护规则**：禁止直接推送、需要PR、需要审核
- **代码审核流程**：创建PR → 审核 → 修改 → 合并
- **审核要点**：功能正确性、代码质量、测试覆盖、文档完整

---

# 课后作业

---

## 任务

1. 创建功能分支，实现一个小功能
2. 提交Pull Request
3. 参与代码审核（审核他人的PR）

## 预习

- PR工作流与项目成熟度评估
- v2.0功能规划

---

<!-- _class: lead -->

# 谢谢！

## 下节课：PR工作流与项目成熟度评估
