# Phase 1 Alpha 维护者自动化与安装补强设计

**Goal:** 在 Phase 1（v1.0.0-alpha 收尾）中补齐“安装程序、测试计划、自动测试脚本、证据产物”，并对所有分支生效，形成可审计、可复现、可发布的基础。

**Architecture:** 通过新增脚本入口（跨平台）、明确测试计划与验收标准、补齐发布打包与校验流程，将“测试+发布”的执行路径标准化，并与 CI 对齐。避免一次性重构，只新增必要脚本与文档，确保教学节奏稳定。

**Tech Stack:** Rust/Cargo, Shell/PowerShell, GitHub Actions, Codecov

---

## 背景与问题
Issue #17 当前聚焦测试补齐与门禁，但缺少：
- 安装/发布包的规范与可复现流程
- 全量测试计划（单元/集成/E2E/性能/回归）的明确范围与通过标准
- 自动化脚本与证据产物要求

## 设计原则
- 面向维护者与发布准备：强调可审计与可执行性
- 一键化：脚本入口统一、失败可诊断
- 证据链：产物可存档、可复核
- 不破坏现有节奏：优先新增脚本与文档，再改 CI

## 新增范围（补充到 Issue #17）
### 1) 安装与发布
- **安装脚本**：`scripts/install.sh` + `scripts/install.ps1`
- **发行包**：`dist/` 下产出压缩包或二进制归档
- **校验信息**：SHA256 校验文件与版本信息
- **最低依赖**：明示 Rust 版本、平台支持范围

### 2) 测试计划（最高标准）
- **单元测试**：模块级（parser/executor/network/transaction）
- **集成测试**：SQL 语句链路、存储/事务
- **E2E/协议测试**：MySQL 连接与基本交互
- **性能/基准**：至少覆盖 SELECT/INSERT/索引查询
- **回归测试**：关键 bug 的再现与验证

每一类测试需明确：范围、优先级、通过标准、失败处理。

### 3) 自动测试脚本
- **统一入口**：`scripts/test-all.sh` + `scripts/test-all.ps1`
- **输出规范**：日志 + 报告 + 摘要
- **失败策略**：失败即退出，保留日志，提示下一步

### 4) 证据产物
- `artifacts/`：测试报告、覆盖率、日志摘要
- `dist/`：安装包/二进制 + 校验文件

## 分支策略对齐
- **全部分支适用**：feature/baseline/main
- **CI 对齐**：CI 增加调用统一脚本，并确保 PR 与 push 均可验证

## 非目标
- 不在 Phase 1 内完成完整发布管道（例如签名、包管理器发布）
- 不引入复杂依赖或平台特化构建系统

## 风险与缓解
- **风险**：脚本与现有 CI 不一致
  - 缓解：CI 复用脚本入口
- **风险**：跨平台脚本维护成本
  - 缓解：先覆盖 macOS/Linux + Windows PowerShell，保持脚本简洁

## 验收标准（新增）
- `scripts/test-all.*` 可在本地一键运行并输出 `artifacts/`
- `scripts/install.*` 可在干净环境执行并产出 `dist/`
- `dist/` 包含可执行文件与 SHA256 校验
- 测试计划文档包含范围/优先级/通过标准/失败处理
- CI 对齐并使用统一脚本入口

## 交付物
- 测试计划文档（维护者视角）
- 自动化脚本（Shell + PowerShell）
- 安装与发布脚本/包
- 证据产物目录结构说明
