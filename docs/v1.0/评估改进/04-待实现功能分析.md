# 主题四：待实现功能分析报告

> 分支：feature/v1.0.0-evaluation
> 评估范围：v1.0.0 (baseline)

---

## 一、评估概述

### 1.1 评估目的

分析 v1.0.0 版本的待实现功能，确定优先级、依赖关系和工作量，为后续开发提供路线图。

### 1.2 评估范围

| 评估维度 | 内容 |
|:---------|:-----|
| 功能优先级 | 哪些功能应该优先实现 |
| 依赖关系 | 功能之间的调用和依赖 |
| 工作量估算 | 每个功能的工作量评估 |

---

## 二、已实现功能清单

### 2.1 核心功能

| 功能 | 模块 | 状态 | 测试覆盖 |
|:-----|:-----|:-----|:---------|
| SELECT 查询 | parser, executor | ✅ | ✅ |
| INSERT 语句 | parser, executor | ✅ | ✅ |
| UPDATE 语句 | parser, executor | ✅ | ✅ |
| DELETE 语句 | parser, executor | ✅ | ✅ |
| CREATE TABLE | parser, executor | ✅ | ✅ |
| WHERE 子句（基础） | parser, executor | ✅ | ⚠️ |

### 2.2 存储和索引

| 功能 | 模块 | 状态 | 测试覆盖 |
|:-----|:-----|:-----|:---------|
| Page 管理 | storage | ✅ | ✅ |
| BufferPool (LRU) | storage | ✅ | ✅ |
| FileStorage | storage | ✅ | ✅ |
| B+ Tree 索引 | storage | ✅ | ⚠️ |
| WAL 日志 | transaction | ✅ | ✅ |

### 2.3 系统功能

| 功能 | 模块 | 状态 | 测试覆盖 |
|:-----|:-----|:-----|:---------|
| 词法分析 | lexer | ✅ | ✅ |
| 语法解析 | parser | ✅ | ✅ |
| 查询执行 | executor | ✅ | ✅ |
| 事务管理 | transaction | ✅ | ✅ |
| MySQL 协议 | network | ✅ | ✅ |
| REPL | main | ✅ | ✅ |

---

## 三、待实现功能清单

### 3.1 高优先级功能

| 功能 | 模块 | 优先级 | 依赖 |
|:-----|:-----|:-------|:-----|
| ORDER BY | parser, executor | P0 | SELECT |
| LIMIT/OFFSET | parser, executor | P0 | SELECT |
| 聚合函数 | parser, executor | P0 | SELECT |
| WHERE 增强 | parser, executor | P0 | WHERE |
| B+ Tree 修复 | storage | P0 | 索引 |

### 3.2 中优先级功能

| 功能 | 模块 | 优先级 | 依赖 |
|:-----|:-----|:-------|:-----|
| JOIN 查询 | parser, executor | P1 | SELECT, ORDER BY |
| GROUP BY | parser, executor | P1 | SELECT, 聚合 |
| 更多数据类型 | types | P1 | - |
| BufferPool 持久化 | storage | P1 | FileStorage |

### 3.3 低优先级功能

| 功能 | 模块 | 优先级 | 依赖 |
|:-----|:-----|:-------|:-----|
| 复合索引 | storage | P2 | B+ Tree |
| 事务隔离级别 | transaction | P2 | WAL |
| 查询优化器 | executor | P2 | 所有 SQL |
| 部署文档 | docs | P2 | - |

---

## 四、功能依赖关系

### 4.1 依赖关系图

```
                    ┌─────────────┐
                    │  SELECT    │
                    └──────┬──────┘
                           │
           ┌───────────────┼───────────────┐
           │               │               │
           ▼               ▼               ▼
    ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
    │  ORDER BY  │ │ LIMIT/OFFSET│ │    JOIN    │
    └──────┬──────┘ └──────┬──────┘ └──────┬──────┘
           │               │               │
           └───────────────┼───────────────┘
                           │
                           ▼
                    ┌─────────────┐
                    │  GROUP BY  │
                    └──────┬──────┘
                           │
                           ▼
                    ┌─────────────┐
                    │   聚合函数  │
                    └─────────────┘
```

### 4.2 关键依赖链

| 依赖链 | 功能顺序 | 说明 |
|:-------|:---------|:-----|
| SQL-基础 | SELECT → WHERE → ORDER BY → LIMIT | 基础查询流程 |
| SQL-聚合 | SELECT → GROUP BY → 聚合函数 | 分组聚合 |
| SQL-复杂 | SELECT → JOIN → 子查询 | 复杂查询 |
| 存储 | Page → BufferPool → B+ Tree → 索引 | 存储层次 |
| 事务 | WAL → 隔离级别 → 行级锁 | 事务层次 |

---

## 五、工作量估算

### 5.1 功能工作量估算

| 功能 | 复杂度 | 估算工时 | 说明 |
|:-----|:-------|:---------|:-----|
| ORDER BY | 中 | 2-4 小时 | 需要修改 parser + executor |
| LIMIT/OFFSET | 低 | 1-2 小时 | 相对简单 |
| 聚合函数 | 中高 | 4-6 小时 | COUNT/SUM/AVG/MIN/MAX |
| WHERE 增强 | 中 | 2-3 小时 | BETWEEN, IN, LIKE |
| JOIN | 高 | 6-8 小时 | 复杂的数据流 |
| GROUP BY | 中高 | 4-5 小时 | 需要分组逻辑 |

### 5.2 里程碑规划

#### Milestone v1.1.0 - SQL 增强版

| 功能 | 工时 | 累计 |
|:-----|:-----|:-----|
| ORDER BY | 3h | 3h |
| LIMIT/OFFSET | 2h | 5h |
| 聚合函数 | 5h | 10h |
| WHERE 增强 | 3h | 13h |
| B+ Tree 修复 | 4h | 17h |

**目标**：1 周完成

#### Milestone v1.2.0 - 查询增强版

| 功能 | 工时 | 累计 |
|:-----|:-----|:-----|
| JOIN | 7h | 7h |
| GROUP BY | 5h | 12h |
| 数据类型扩展 | 4h | 16h |
| BufferPool 持久化 | 6h | 22h |

**目标**：1 周完成

---

## 六、实现顺序建议

### 6.1 推荐顺序

```
第一阶段（v1.1.0）
├── 1. ORDER BY
├── 2. LIMIT/OFFSET
├── 3. 聚合函数 (COUNT, SUM, AVG)
├── 4. WHERE 增强
└── 5. B+ Tree 修复

第二阶段（v1.2.0）
├── 6. GROUP BY
├── 7. JOIN (INNER)
├── 8. 数据类型扩展
└── 9. BufferPool 持久化

第三阶段（v2.0.0）
├── 10. 复合索引
├── 11. 事务隔离级别
├── 12. 查询优化器
└── 13. 性能优化
```

### 6.2 选择依据

| 排序依据 | 说明 |
|:---------|:-----|
| 教学价值 | 先实现基础功能，再实现高级功能 |
| 依赖关系 | 被依赖的功能优先实现 |
| 工作量 | 大功能拆分，小功能先行 |
| 用户价值 | 用户常用功能优先 |

---

## 七、教学建议

### 7.1 学生学习路径

1. **初级任务**：
   - LIMIT/OFFSET（简单）
   - WHERE 增强（中等）

2. **中级任务**：
   - ORDER BY（涉及排序）
   - 聚合函数（涉及数据处理）

3. **高级任务**：
   - JOIN（复杂的数据流）
   - GROUP BY（分组逻辑）

### 7.2 功能实现练习

| 任务 | 描述 | 难度 |
|:-----|:-----|:-----|
| F-01 | 实现 LIMIT 子句 | ⭐ |
| F-02 | 实现 ORDER BY | ⭐⭐ |
| F-03 | 实现 COUNT 聚合 | ⭐⭐ |
| F-04 | 实现 WHERE IN | ⭐⭐ |
| F-05 | 实现 INNER JOIN | ⭐⭐⭐ |
| F-06 | 实现 GROUP BY | ⭐⭐⭐ |

---

## 八、总结

### 8.1 评估结论

| 维度 | 评级 | 说明 |
|:-----|:-----|:-----|
| 功能完整性 | ⭐⭐ | 基础功能完成，高级功能缺失 |
| 优先级清晰度 | ⭐⭐⭐⭐ | 有明确的优先级划分 |
| 依赖关系 | ⭐⭐⭐ | 依赖关系清晰 |

### 8.2 开发建议

| 阶段 | 重点 | 目标 |
|:-----|:-----|:-----|
| v1.1.0 | SQL 基础完善 | 完善基础查询功能 |
| v1.2.0 | 复杂查询支持 | JOIN, GROUP BY |
| v2.0.0 | 生产就绪 | 性能优化、稳定性 |

### 8.3 相关文档

- [ROADMAP](../ROADMAP.md)
- [改进计划](../v1.0.0/改进计划.md)

---

> 本报告用于分析待实现功能，为后续开发提供路线图。
